<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Watch live football streams, view schedules, and enjoy matches in high quality.">
    <title>Football Live Streams - Premium Experience</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff9900;
            --secondary-color: #ffb366;
            --bg-dark: #0f0f0f;
            --bg-medium: #1a1a1a;
            --bg-light: #2a2a2a;
            --text-light: #e0e0e0;
            --text-medium: #cccccc;
            --text-dark: #bbbbbb;
            --shadow: rgba(0, 0, 0, 0.5);
            --accent-green: #00ff66;
            --accent-yellow: #ffcc33;
            --accent-red: #ff6666;
            --accent-blue: #00ccff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, var(--bg-dark), var(--bg-medium));
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        header {
            padding: 20px 40px;
            background: linear-gradient(90deg, var(--bg-medium), var(--bg-light));
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1500;
        }

        header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--primary-color);
            text-shadow: 0 1px 3px rgba(255, 153, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        header h1 i {
            font-size: 1.8rem;
        }

        .nav-tabs {
            display: flex;
            gap: 20px;
        }

        .nav-tab {
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            background: var(--bg-light);
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-medium);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: #444444;
            transform: scale(1.05);
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: #fff;
            transform: scale(1.1);
            box-shadow: 0 2px 6px rgba(255, 153, 0, 0.4);
        }

        #statusBar {
            padding: 12px 40px;
            background: #222222;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            border-bottom: 2px solid #3a3a3a;
            box-shadow: 0 2px 8px var(--shadow);
        }

        #statusBar .warning {
            color: var(--accent-yellow);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #statusBar .status-loading { color: var(--accent-blue); }
        #statusBar .status-active { color: var(--accent-green); }
        #statusBar .status-frozen { color: var(--accent-red); }
        #statusBar .status-not-playing { color: var(--accent-yellow); }

        #timer {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-light);
            text-shadow: 0 1px 2px var(--shadow);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page {
            display: none;
            flex: 1;
            overflow-y: auto;
            animation: fadeIn 0.4s ease;
            padding: 30px 40px;
        }

        .page.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #match.active {
            padding: 0;
            height: calc(100vh - 80px); /* Adjust for header and status bar */
        }

        #playerContainer {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex: 1;
            background: #000;
            overflow: hidden;
        }

        #playerContainer::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px solid rgba(255, 153, 0, 0.3);
            border-radius: 10px;
            pointer-events: none;
            z-index: 1;
        }

        iframe#playerFrame {
            width: 100%;
            height: 100%;
            border: none;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
        }

        #fullscreenBtn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 2;
            transition: all 0.3s;
        }

        #fullscreenBtn:hover {
            background: var(--primary-color);
        }

        .schedule-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-bar {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            background: #333333;
            border: none;
            border-radius: 8px;
            color: var(--text-light);
            font-size: 1rem;
        }

        .search-bar input::placeholder {
            color: var(--text-medium);
        }

        .search-bar i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-medium);
        }

        .control-btn {
            padding: 10px 20px;
            background: #333333;
            border: none;
            border-radius: 8px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            background: #444444;
            transform: scale(1.05);
            box-shadow: 0 2px 6px var(--shadow);
        }

        .schedule-grid {
            display: grid;
            gap: 25px;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        }

        .schedule-item {
            background: linear-gradient(135deg, #252525, #333333);
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 2px solid #444444;
            box-shadow: 0 6px 18px var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .schedule-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px var(--shadow);
            background: linear-gradient(135deg, #2e2e2e, #3c3c3c);
        }

        .match-poster {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            transition: transform 0.3s ease;
        }

        .schedule-item:hover .match-poster {
            transform: scale(1.05);
        }

        .match-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .match-details h3 {
            margin: 0;
            font-size: 1.6rem;
            color: var(--primary-color);
            text-shadow: 0 1px 3px rgba(255, 153, 0, 0.3);
            transition: color 0.3s ease;
        }

        .schedule-item:hover h3 {
            color: var(--secondary-color);
        }

        .match-details p {
            margin: 0;
            font-size: 1rem;
            color: var(--text-dark);
            transition: color 0.3s ease;
        }

        .schedule-item:hover p {
            color: var(--text-medium);
        }

        .match-status {
            font-size: 0.9rem;
            font-weight: 700;
            padding: 6px 15px;
            border-radius: 20px;
            text-align: center;
            margin-top: 10px;
            transition: background 0.3s ease;
            width: fit-content;
        }

        .match-status.live { background: var(--accent-green); color: #000; }
        .match-status.upcoming { background: var(--accent-yellow); color: #000; }
        .match-status.finished { background: var(--accent-red); color: #fff; }

        .stream-list {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            margin-top: 20px;
        }

        .stream-item {
            padding: 15px;
            background: linear-gradient(135deg, #2a2a2a, #3a3a3a);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #444444;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px var(--shadow);
            gap: 10px;
        }

        .stream-item i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .stream-item:hover {
            background: linear-gradient(135deg, #333333, #4a4a4a);
            transform: translateY(-5px);
            box-shadow: 0 6px 15px var(--shadow);
        }

        #streamMatchTitle {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 1px 3px rgba(255, 153, 0, 0.3);
        }

        #loadingSpinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 12px solid #333333;
            border-top: 12px solid var(--primary-color);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
            z-index: 2000;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        footer {
            padding: 15px 40px;
            background: var(--bg-medium);
            text-align: center;
            color: var(--text-medium);
            font-size: 0.9rem;
            border-top: 1px solid #3a3a3a;
        }

        @media (max-width: 1024px) {
            .schedule-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 10px;
            }

            .nav-tabs {
                gap: 10px;
                justify-content: center;
            }

            .nav-tab {
                font-size: 1rem;
                padding: 8px 15px;
            }

            #statusBar {
                padding: 10px 20px;
                flex-direction: column;
                gap: 10px;
            }

            .page {
                padding: 20px;
            }

            .schedule-grid {
                grid-template-columns: 1fr;
            }

            .stream-list {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }

            #streamMatchTitle {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 1.8rem;
            }

            .control-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            .search-bar input {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-futbol"></i> Football Live Streams</h1>
        <div class="nav-tabs" id="navTabs">
            <div class="nav-tab active" data-page="schedule"><i class="fas fa-calendar-alt"></i> Schedule</div>
            <div class="nav-tab" data-page="streams"><i class="fas fa-stream"></i> Streams</div>
            <div class="nav-tab" data-page="match"><i class="fas fa-tv"></i> Match</div>
        </div>
    </header>
    <div id="statusBar">
        <div class="warning" id="streamStatus"><i class="fas fa-exclamation-triangle"></i> Stream may experience interruptions</div>
        <div id="timer"><i class="fas fa-clock"></i> Match Timer: 00:00</div>
    </div>
    <div id="schedule" class="page active">
        <div class="schedule-controls">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search matches..." oninput="searchMatches()">
                <i class="fas fa-search"></i>
            </div>
            <button class="control-btn" onclick="sortByTime()"><i class="fas fa-sort-amount-up"></i> Sort by Time</button>
            <button class="control-btn" onclick="filterByStatus('upcoming')"><i class="fas fa-hourglass-start"></i> Upcoming</button>
            <button class="control-btn" onclick="filterByStatus('live')"><i class="fas fa-broadcast-tower"></i> Live</button>
            <button class="control-btn" onclick="filterByStatus('finished')"><i class="fas fa-check-circle"></i> Finished</button>
            <button class="control-btn" onclick="filterByStatus('all')"><i class="fas fa-list"></i> All</button>
        </div>
        <div class="schedule-grid" id="scheduleGrid"></div>
    </div>
    <div id="streams" class="page">
        <h2 id="streamMatchTitle"></h2>
        <div class="stream-list" id="streamList"></div>
    </div>
    <div id="match" class="page">
        <div id="playerContainer">
            <iframe id="playerFrame" src="" allowfullscreen allow="encrypted-media; picture-in-picture; fullscreen"></iframe>
            <button id="fullscreenBtn" onclick="toggleFullscreen()"><i class="fas fa-expand"></i></button>
        </div>
    </div>
    <div id="loadingSpinner"></div>
    <footer>
        &copy; 2025 Football Live Streams. All rights reserved. | Powered by streamed.pk
    </footer>
    <script>
        let matches = [];
        let currentMatchIndex = 0;
        let currentStreamIndex = 0;
        let currentPage = 'schedule';
        let timerInterval = null;
        let streamLoadTimeout = null;
        let streamCheckInterval = null;
        let isStreamPlaying = false;
        const navTabs = document.getElementById('navTabs');
        const scheduleGrid = document.getElementById('scheduleGrid');
        const streamMatchTitle = document.getElementById('streamMatchTitle');
        const streamList = document.getElementById('streamList');
        const playerFrame = document.getElementById('playerFrame');
        const streamStatus = document.getElementById('streamStatus');
        const timerEl = document.getElementById('timer');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Page navigation
        navTabs.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                currentPage = tab.dataset.page;
                updatePage();
            });
        });

        function updatePage() {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.toggle('active', page.id === currentPage);
            });
            navTabs.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.page === currentPage);
            });
            if (currentPage === 'schedule') {
                renderSchedule('all');
                clearTimers();
                resetStreamStatus();
            } else if (currentPage === 'streams') {
                renderStreams();
                clearTimers();
                resetStreamStatus();
            } else if (currentPage === 'match') {
                loadStream();
                startMatchTimer();
                startStreamCheck();
            }
        }

        function clearTimers() {
            if (timerInterval) clearInterval(timerInterval);
            if (streamCheckInterval) clearInterval(streamCheckInterval);
            if (streamLoadTimeout) clearTimeout(streamLoadTimeout);
        }

        function resetStreamStatus() {
            streamStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Stream may experience interruptions';
            streamStatus.className = 'warning';
            isStreamPlaying = false;
        }

        // Fetch matches from API
        async function fetchMatches() {
            showLoading(true);
            try {
                const response = await fetch('https://streamed.pk/api/matches/football');
                const data = await response.json();
                matches = data
                    .filter(m => m.category === 'football' && m.date > 0)
                    .map(m => ({
                        name: m.title,
                        startTime: new Date(m.date),
                        sources: m.sources,
                        poster: m.poster || 'https://via.placeholder.com/400x200?text=No+Poster',
                        teams: m.teams || ['Team A', 'Team B']
                    }));
                matches.sort((a, b) => a.startTime - b.startTime);
                renderSchedule('all');
            } catch (error) {
                console.error('Error fetching matches:', error);
                scheduleGrid.innerHTML = '<div style="text-align:center; color:var(--accent-red);">Error loading schedule. Please try again later.</div>';
            } finally {
                showLoading(false);
            }
        }

        // Render schedule
        function renderSchedule(filterStatus = 'all', searchQuery = '') {
            scheduleGrid.innerHTML = '';
            const now = new Date();
            const fourHoursInMs = 4 * 60 * 60 * 1000;
            matches.forEach((match, index) => {
                const elapsed = Math.floor((now - match.startTime) / 1000);
                let status = 'finished';
                let timeText = 'Finished';
                if (elapsed < 0) {
                    status = 'upcoming';
                    timeText = `Starts in ${formatTime(Math.abs(elapsed))}`;
                } else if (elapsed < 120 * 60) {
                    status = 'live';
                    timeText = `Live for ${formatTime(elapsed)}`;
                }
                const matchEndTime = new Date(match.startTime.getTime() + 110 * 60 * 1000);
                const matchesFilter = filterStatus === 'all' || status === filterStatus;
                const matchesSearch = !searchQuery || match.name.toLowerCase().includes(searchQuery.toLowerCase());
                if (now - matchEndTime <= fourHoursInMs && matchesFilter && matchesSearch) {
                    const item = document.createElement('div');
                    item.className = 'schedule-item';
                    item.innerHTML = `
                        <img src="${match.poster}" alt="${match.name} Poster" class="match-poster">
                        <div class="match-details">
                            <h3>${match.name}</h3>
                            <p>Teams: ${match.teams.join(' vs ')}</p>
                            <p>Time: ${timeText}</p>
                            <span class="match-status ${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>
                        </div>
                    `;
                    item.onclick = () => {
                        currentMatchIndex = index;
                        currentStreamIndex = 0;
                        currentPage = 'streams';
                        updatePage();
                    };
                    scheduleGrid.appendChild(item);
                }
            });
            if (scheduleGrid.innerHTML === '') {
                scheduleGrid.innerHTML = '<div style="text-align:center; color:var(--text-medium);">No matches found.</div>';
            }
        }

        function sortByTime() {
            matches.sort((a, b) => a.startTime - b.startTime);
            renderSchedule(document.querySelector('#searchInput')?.value || '');
        }

        function filterByStatus(status) {
            renderSchedule(status, document.querySelector('#searchInput')?.value || '');
        }

        function searchMatches() {
            const query = document.getElementById('searchInput').value;
            renderSchedule('all', query);
        }

        // Render streams
        async function renderStreams() {
            const match = matches[currentMatchIndex];
            streamMatchTitle.textContent = match.name;
            streamList.innerHTML = '<div style="text-align:center; color:var(--text-medium);">Loading streams...</div>';
            try {
                const allStreamsArrays = await Promise.all(match.sources.map(async source => {
                    try {
                        const res = await fetch(`https://streamed.pk/api/stream/${source.source}/${source.id}`);
                        const streamData = await res.json();
                        return streamData.map(s => s.embedUrl).filter(url => url);
                    } catch {
                        return [];
                    }
                }));
                const allUrls = allStreamsArrays.flat();
                match.streams = allUrls;
                streamList.innerHTML = '';
                if (allUrls.length === 0) {
                    streamList.innerHTML = '<div style="text-align:center; color:var(--accent-red);">No streams available for this match.</div>';
                    return;
                }
                allUrls.forEach((url, index) => {
                    const item = document.createElement('div');
                    item.className = 'stream-item';
                    item.innerHTML = `<i class="fas fa-play-circle"></i> Stream ${index + 1}`;
                    item.onclick = () => {
                        currentStreamIndex = index;
                        currentPage = 'match';
                        updatePage();
                    };
                    streamList.appendChild(item);
                });
            } catch (error) {
                console.error('Error fetching streams:', error);
                streamList.innerHTML = '<div style="text-align:center; color:var(--accent-red);">Error loading streams. Please try again.</div>';
            }
        }

        // Load stream
        function loadStream() {
            const match = matches[currentMatchIndex];
            if (!match.streams || currentStreamIndex >= match.streams.length) {
                streamStatus.innerHTML = '<i class="fas fa-times-circle"></i> No more streams available';
                streamStatus.className = 'status-frozen';
                return;
            }
            playerFrame.src = match.streams[currentStreamIndex];
            streamStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading stream...';
            streamStatus.className = 'status-loading';
            isStreamPlaying = false;
            clearTimeout(streamLoadTimeout);
            streamLoadTimeout = setTimeout(() => {
                if (!isStreamPlaying) {
                    streamStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> Stream failed to load, trying next...';
                    streamStatus.className = 'status-frozen';
                    currentStreamIndex = (currentStreamIndex + 1) % match.streams.length;
                    loadStream();
                }
            }, 8000); // Increased timeout for better reliability

            playerFrame.onload = () => {
                isStreamPlaying = true;
                streamStatus.innerHTML = '<i class="fas fa-check-circle"></i> Stream active';
                streamStatus.className = 'status-active';
                clearTimeout(streamLoadTimeout);
            };

            playerFrame.onerror = () => {
                isStreamPlaying = false;
                streamStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> Stream failed to load, trying next...';
                streamStatus.className = 'status-frozen';
                currentStreamIndex = (currentStreamIndex + 1) % match.streams.length;
                loadStream();
            };
        }

        // Stream check
        function startStreamCheck() {
            clearInterval(streamCheckInterval);
            streamCheckInterval = setInterval(() => {
                if (currentPage !== 'match') return;
                if (isStreamPlaying) {
                    streamStatus.innerHTML = '<i class="fas fa-check-circle"></i> Stream active';
                    streamStatus.className = 'status-active';
                } else {
                    streamStatus.innerHTML = '<i class="fas fa-pause-circle"></i> Stream not playing';
                    streamStatus.className = 'status-not-playing';
                }
            }, 3000);
        }

        // Match timer
        function startMatchTimer() {
            clearInterval(timerInterval);
            const match = matches[currentMatchIndex];
            const startTime = match.startTime;
            timerInterval = setInterval(() => {
                const currentTime = new Date();
                let elapsed = Math.floor((currentTime - startTime) / 1000);
                let displayText = "";
                if (elapsed < 0) {
                    displayText = `<i class="fas fa-hourglass-start"></i> Starts In: ${formatTime(Math.abs(elapsed))}`;
                } else if (elapsed < 45 * 60) {
                    displayText = `<i class="fas fa-clock"></i> ${formatTime(elapsed)} (1st Half)`;
                } else if (elapsed < 50 * 60) {
                    displayText = `<i class="fas fa-clock"></i> ${formatTime(elapsed - 45 * 60)} (1st Half +)`;
                } else if (elapsed < 60 * 60) {
                    displayText = `<i class="fas fa-pause"></i> Halftime: ${formatTime(elapsed - 50 * 60)}`;
                } else if (elapsed < 105 * 60) {
                    displayText = `<i class="fas fa-clock"></i> ${formatTime(elapsed - 15 * 60)} (2nd Half)`;
                } else if (elapsed < 110 * 60) {
                    displayText = `<i class="fas fa-clock"></i> ${formatTime(elapsed - 105 * 60)} (2nd Half +)`;
                } else {
                    displayText = `<i class="fas fa-flag-checkered"></i> Full Time`;
                    clearInterval(timerInterval);
                }
                timerEl.innerHTML = displayText;
            }, 1000);
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        function toggleFullscreen() {
            const container = document.getElementById('playerContainer');
            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(err => console.error('Fullscreen error:', err));
            } else {
                document.exitFullscreen();
            }
        }

        function showLoading(show) {
            loadingSpinner.style.display = show ? 'block' : 'none';
        }

        // Initialize
        fetchMatches();
        updatePage();
        setInterval(fetchMatches, 300000); // Auto-refresh every 5 minutes
    </script>
</body>
</html>
